<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vr-kafe-panel | Tam SÃ¼rÃ¼m</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0b0b0b; color: #e0e0e0; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        #sidebar { width: 340px; background: #151515; padding: 20px; border-right: 2px solid #222; overflow-y: auto; }
        #main { flex: 1; padding: 25px; background: #0b0b0b; overflow-y: auto; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .card { background: #1c1c1c; padding: 20px; border-radius: 15px; border: 2px solid #333; text-align: center; position: relative; border-top: 4px solid #2563eb; }
        .card.sure-doldu { border-top-color: #ff3e3e; box-shadow: 0 0 20px rgba(255, 62, 62, 0.2); }
        .timer { font-size: 42px; font-weight: bold; color: #00fbff; margin: 10px 0; font-family: 'Courier New', monospace; }
        .btn { cursor: pointer; border: none; padding: 10px; border-radius: 6px; font-weight: bold; width: 100%; margin-top: 5px; color: white; }
        .btn-vr { background: #2563eb; }
        .btn-pay { background: #16a34a; margin-top: 15px; border: 1px solid #22c55e; box-shadow: 0 4px 0 #15803d; }
        .btn-pay:active { transform: translateY(4px); box-shadow: none; }
        .btn-delete { background: #991b1b; font-size: 11px; width: auto; padding: 4px 8px; border-radius: 4px; }
        input, select { background: #252525; color: white; border: 1px solid #444; padding: 10px; width: 100%; margin: 5px 0; border-radius: 6px; }
        .rapor-item { background: #222; padding: 8px; border-radius: 5px; margin-bottom: 5px; font-size: 12px; display: flex; justify-content: space-between; align-items: center; border-left: 3px solid #16a34a; }
        h3 { border-bottom: 1px solid #333; padding-bottom: 8px; color: #00fbff; margin-top: 20px; }
    </style>
</head>
<body>

<div id="sidebar">
    <h2 style="color: #00fbff; margin-top:0;">ðŸŽ® VR KAFE PANEL</h2>
    
    <h3>ðŸ’° Fiyat AyarlarÄ±</h3>
    <label style="font-size:12px;">30 Dk (â‚º)</label>
    <input type="number" id="f-30" value="250">
    <label style="font-size:12px;">60 Dk (â‚º)</label>
    <input type="number" id="f-60" value="450">
    
    <h3>â˜• Kantin & HÄ±zlÄ± SatÄ±ÅŸ</h3>
    <select id="hedef-masa">
        <option value="1">Masa 1</option><option value="2">Masa 2</option>
        <option value="3">Masa 3</option><option value="4">Masa 4</option>
        <option value="5">Masa 5</option><option value="6">Masa 6</option>
        <option value="MISAFIR">ðŸ‘¤ AyakÃ¼stÃ¼ Misafir</option>
    </select>
    <button class="btn" style="background:#d97706" id="btn-urun-ekle">âž• ÃœrÃ¼n Ekle (20â‚º)</button>
    
    <h3>ðŸ“Š BugÃ¼nÃ¼n Raporu</h3>
    <div id="rapor-listesi"></div>
    <div id="gunluk-toplam" style="margin-top:15px; font-size: 18px; font-weight:bold; color:#22c55e; border-top: 1px solid #333; padding-top: 10px;">Ciro: 0â‚º</div>
</div>

<div id="main">
    <div class="grid" id="cihazlar"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, set, onValue, remove, push } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCGk6ca-X8wCbLB7xOu5imiH6g23ZmazyQ",
        authDomain: "vr-kafe-panel.firebaseapp.com",
        databaseURL: "https://vr-kafe-panel-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "vr-kafe-panel",
        storageBucket: "vr-kafe-panel.firebasestorage.app",
        messagingSenderId: "464538264349",
        appId: "1:464538264349:web:09bf50fd4ac50e1372b7f4"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    let cihazVerileri = {};

    window.cihazlariOlustur = function() {
        const grid = document.getElementById('cihazlar');
        grid.innerHTML = ''; 
        for(let i=1; i<=6; i++) {
            if(!cihazVerileri[i]) cihazVerileri[i] = { bitis_ms: 0, toplam: 0 };
            grid.innerHTML += `
                <div class="card" id="card-${i}">
                    <h2 style="margin:0;">Ä°stasyon #${i}</h2>
                    <div class="timer" id="time-${i}">00:00</div>
                    <div style="font-size:16px; margin-bottom:10px; color:#aaa;">BorÃ§: <b style="color:#fff;">${cihazVerileri[i].toplam}â‚º</b></div>
                    <button class="btn btn-vr" onclick="vrEkle(${i},30)">+30 Dakika</button>
                    <button class="btn btn-vr" onclick="vrEkle(${i},60)">+60 Dakika</button>
                    <button class="btn btn-pay" onclick="odemeAl(${i})">ðŸ’° Ã–DEME AL & KAPAT</button>
                </div>`;
        }
    }

    window.vrEkle = function(id, dk) {
        let fiyat = dk === 30 ? parseInt(document.getElementById('f-30').value) : parseInt(document.getElementById('f-60').value);
        let simdi = new Date().getTime();
        let temel = (cihazVerileri[id].bitis_ms > simdi) ? cihazVerileri[id].bitis_ms : simdi;
        cihazVerileri[id].bitis_ms = temel + (dk * 60 * 1000);
        cihazVerileri[id].toplam += fiyat;
        firebaseGuncelle(id);
    }

    document.getElementById('btn-urun-ekle').onclick = function() {
        let id = document.getElementById('hedef-masa').value;
        if(id === "MISAFIR") {
            raporEkle("DÄ±ÅŸ SatÄ±ÅŸ", 20);
        } else {
            cihazVerileri[id].toplam += 20;
            firebaseGuncelle(id);
        }
    };

    function firebaseGuncelle(id) {
        set(ref(db, 'aktif_masalar/' + id), {
            bitis_ms: cihazVerileri[id].bitis_ms,
            toplam: cihazVerileri[id].toplam
        });
    }

    // --- Ã–DEME ALMA VE RAPORA Ä°ÅžLEME ---
    window.odemeAl = function(id) {
        let tutar = cihazVerileri[id].toplam;
        if(tutar <= 0) {
            if(confirm("Masa borcu yok. Yine de sÄ±fÄ±rlamak istiyor musunuz?")) {
                remove(ref(db, 'aktif_masalar/' + id));
            }
            return;
        }
        
        if(confirm(`Masa #${id} iÃ§in ${tutar}â‚º Ã¶deme alÄ±ndÄ± mÄ±? \n\nOnaylarsanÄ±z raporlara eklenecek ve masa sÄ±fÄ±rlanacaktÄ±r.`)) {
            raporEkle(`Masa #${id} Ã–demesi`, tutar);
            remove(ref(db, 'aktif_masalar/' + id));
        }
    }

    function raporEkle(isim, tutar) {
        const yeniRaporRef = push(ref(db, 'raporlar'));
        set(yeniRaporRef, {
            isim: isim,
            tutar: tutar,
            saat: new Date().toLocale
